cmake_minimum_required(VERSION 3.28)

project(bire_adv)

option(USE_NATIVE_INSTRUCTIONS "Optimize for host CPU at the cost of portability !" OFF)

set(CMAKE_CXX_STANDARD 23)
set(CMAKE_CXX_STANDARD_REQUIRED YES)

file(GLOB_RECURSE SOURCES Source/**.cpp)
file(GLOB_RECURSE HEADERS Include/**.hpp)

add_executable(${PROJECT_NAME} ${SOURCES} ${HEADERS})

# Thanks Google Gemini(.clang-format was also generated by Google Gemini)
# Note : Only the Clang Format part is from Gemini, the rest of CMakeLists.txt was made by me a long time ago(template).
find_program(CLANG_FORMAT "clang-format")

if(CLANG_FORMAT)
    add_custom_target(auto_format ALL COMMAND ${CLANG_FORMAT} -i -style=file ${SOURCES} ${HEADERS} WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR} COMMENT "Applying formatting rules to Source/ and Include/...")
    add_dependencies(${PROJECT_NAME} auto_format)
else()
    message(STATUS "clang-format not found - auto-formatting disabled")
endif()

target_include_directories(${PROJECT_NAME} PRIVATE Include)

if(USE_NATIVE_INSTRUCTIONS)
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -march=native")
endif()
